<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Operational Excellence and Support Quiz</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f7fa;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: #ffffff;
      padding: 30px;
      margin-top: 40px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 700px;
    }
    h1 {
      text-align: center;
      color: #2b3a55;
      margin-bottom: 30px;
    }
    label {
      display: block;
      margin-bottom: 15px;
      font-size: 16px;
    }
    input[type="text"], input[type="email"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      margin-top: 5px;
    }
    button {
      background-color: #0057a4;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background-color: #003f7d;
    }
    .question {
      margin-bottom: 20px;
    }
    .question p {
      font-weight: bold;
    }
    .question label {
      font-weight: normal;
    }
    .hidden {
      display: none;
    }
    .final-result {
      text-align: center;
      margin-top: 30px;
      font-size: 18px;
      color: #2b3a55;
    }
    .pass { color: green; font-weight: bold; }
    .fail { color: red; font-weight: bold; }
    .segment-title {
      font-weight: bold;
      font-size: 20px;
      text-align: center;
      margin-bottom: 20px;
      color: #2b3a55;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Operational Excellence and Support Quiz</h1>
<p style="text-align: center; font-size: 16px; color: #555;">You need to score at least 75% to pass this quiz.</p>
    <div id="loginPanel">
      <label>Name:
        <input id="userName" placeholder="Enter your name" type="text" />
      </label>
      <label>Email:
        <input id="userEmail" placeholder="Enter your email" type="email" />
      </label>
      <button onclick="startQuiz()">Start Quiz</button>
    </div>
    <div class="hidden" id="quizPanel"></div>
    <div class="hidden final-result" id="finalScore"></div>
  </div>

  <script id="quiz-data" type="application/json">{
  "quizName": "Operational Excellence and Support",
  "segmentTitles": [
    "Topic 1: Support Ecosystem for Data",
    "Topic 2: Issue Management",
    "Topic 3: Demand & Feature Management for In-Life Products",
    "Topic 4: Measurement & Reporting"
  ],
  "segments": [
    [
      {
        "question": "What should every certified data product include?",
        "options": [
          "A backup PowerPoint",
          "A named support contact",
          "A link to the original ADO story",
          "A summary of the PI planning session"
        ],
        "answer": 1
      },
      {
        "question": "Where should support issues be logged?",
        "options": [
          "Directly emailed to the dashboard creator",
          "Shared in a Teams chat",
          "Through a standardised logging tool like ADO or Symphony Support",
          "Posted on Viva Engage"
        ],
        "answer": 2
      },
      {
        "question": "Why is a visible support model important?",
        "options": [
          "It allows data teams to focus on delivery",
          "It builds user trust and ensures timely issue resolution",
          "It reduces time spent on platform upgrades",
          "It ensures ownership is only technical"
        ],
        "answer": 1
      }
    ],
    [
      {
        "question": "What should happen after an issue is logged?",
        "options": [
          "Wait for the user to follow up",
          "Patch it quietly and move on",
          "Triage the issue and assign ownership",
          "Escalate immediately to the data owner"
        ],
        "answer": 2
      },
      {
        "question": "Why is root cause analysis (RCA) important?",
        "options": [
          "It helps update Power BI dashboards",
          "It prevents the same issue from recurring",
          "It reduces ADO ticket volume",
          "It ensures issues are logged in the right format"
        ],
        "answer": 1
      },
      {
        "question": "What does the Playbook say about communication during issue resolution?",
        "options": [
          "Only required if the report is critical",
          "Optional if a workaround is found",
          "Not needed unless users complain",
          "Users should be kept informed of status and timelines"
        ],
        "answer": 3
      }
    ],
    [
      {
        "question": "How should in-life enhancement requests be managed during the interim approach?",
        "options": [
          "Passed informally by email",
          "Added directly by developers",
          "Logged in a trackable backlog tool and prioritised",
          "Discussed in weekly stand-ups only"
        ],
        "answer": 2
      },
      {
        "question": "Who is responsible for reviewing and accepting in-life feature requests?",
        "options": [
          "Data Custodian",
          "Scrum Master",
          "Product Owner",
          "Support Analyst"
        ],
        "answer": 2
      },
      {
        "question": "What is one key expectation in the Playbook for interim feature management?",
        "options": [
          "Prioritisation should be based on team availability",
          "All requests must be routed through the original delivery project",
          "Requestors must be informed of status and outcomes",
          "Enhancements should be delayed until quarterly planning"
        ],
        "answer": 2
      }
    ],
    [
      {
        "question": "Why is measurement important in operational support?",
        "options": [
          "To track developer productivity",
          "To monitor data warehouse size",
          "To identify trends and improve support over time",
          "To reduce the need for Product Owners"
        ],
        "answer": 2
      },
      {
        "question": "Which metric helps reveal recurring product issues?",
        "options": [
          "Page views on SharePoint",
          "Reopened support tickets",
          "Number of Power BI tabs",
          "UAT test case count"
        ],
        "answer": 1
      },
      {
        "question": "What should Product Owners and Governance teams regularly receive?",
        "options": [
          "Detailed user manuals",
          "Operational performance reporting",
          "Marketing performance dashboards",
          "Change logs from ADO"
        ],
        "answer": 1
      }
    ]
  ]
}</script>

  <script>
    const quizData = JSON.parse(document.getElementById("quiz-data").textContent);
    const quizName = quizData.quizName;
    const questions = quizData.segments;
    const segmentTitles = quizData.segmentTitles;
    const isSegmented = Array.isArray(questions[0]);

    let userAnswers = [];
    let questionLog = [];
    let currentSegment = 0;
    let userName = "";
    let userEmail = "";

    function startQuiz() {
      userName = document.getElementById("userName").value;
      userEmail = document.getElementById("userEmail").value;
      if (!userName || !userEmail) {
        alert("Please enter both name and email.");
        return;
      }
      document.getElementById("loginPanel").classList.add("hidden");
      document.getElementById("quizPanel").classList.remove("hidden");
      showSegment();
    }

    function showSegment() {
      const quizPanel = document.getElementById("quizPanel");
      quizPanel.innerHTML = "";

      const segment = isSegmented ? questions[currentSegment] : questions;
      const title = isSegmented ? segmentTitles[currentSegment] : quizName;
      if (!segment || (!isSegmented && currentSegment > 0)) {
        showFinalScore();
        return;
      }

      const form = document.createElement("form");
      form.innerHTML = `<div class='segment-title'>${title}</div>`;

      segment.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `<p>${q.question}</p>` +
          q.options.map((opt, j) => `
            <label><input type="radio" name="q${i}" value="${j}"> ${opt}</label>
          `).join("");
        form.appendChild(div);
      });

      const btn = document.createElement("button");
      btn.type = "button";
      btn.textContent = isSegmented ? "Submit Topic" : "Submit Quiz";
      btn.onclick = () => submitSegment(form, segment);
      form.appendChild(btn);
      quizPanel.appendChild(form);
    }

    function submitSegment(form, segment) {
      let score = 0;
      let allAnswered = true; // Flag to check if all questions are answered

      segment.forEach((q, i) => {
        const selected = form.querySelector(`input[name=q${i}]:checked`);
        const selectedVal = selected ? parseInt(selected.value) : null;

        if (selectedVal === null) { // Check if a question is not answered
          allAnswered = false; //
        }

        questionLog.push({ question: q.question, selected: selectedVal !== null ? q.options[selectedVal] : "None", correct: q.options[q.answer] });
        if (selectedVal === q.answer) score++;
      });

      if (!allAnswered) { // If not all questions are answered
        alert("Please answer all questions before submitting this topic."); //
        // Remove the last pushed questions from questionLog as the segment was not submitted
        questionLog.splice(questionLog.length - segment.length, segment.length); //
        return; // Stop the function if not all questions are answered
      }

      const totalCorrectSoFar = userAnswers.reduce((a, b) => a + b, 0) + score;
     const totalQuestionsSoFar = userAnswers.reduce((a, b, i) => a + questions[i].length, 0) + segment.length;
      const segmentPercent = Math.round((score / segment.length) * 100);
      const totalPercent = Math.round((totalCorrectSoFar / totalQuestionsSoFar) * 100);

      userAnswers.push(score);

      alert(`Topic completed.
Segment Score: ${score} / ${segment.length} (${segmentPercent}%)
Correct answers so far: ${totalCorrectSoFar} / ${totalQuestionsSoFar} (${totalPercent}%)`);

      currentSegment++;
      showSegment();
    }

    function showFinalScore() {
      const totalCorrect = userAnswers.reduce((a, b) => a + b, 0);
      const totalQuestions = questions.flat().length;
      const percentage = Math.round((totalCorrect / totalQuestions) * 100);
      const passed = percentage >= 75;

      const final = document.getElementById("finalScore");
      final.classList.remove("hidden");
      final.innerHTML = `
        <h2>Final Score</h2>
        <p><strong>${userName}</strong> (${userEmail})</p>
        <p>Total Questions: ${totalQuestions}</p>
        <p>Total Correct: ${totalCorrect}</p>
        <p>Score: ${percentage}%</p>
        <p class="${passed ? 'pass' : 'fail'}">${passed ? 'Pass 🎉' : 'Fail ❌'}</p>
        <button onclick="resetQuiz()">Retake Quiz</button>
      `;

      sendToGoogleSheet(userName, userEmail, userAnswers, totalCorrect, totalQuestions, percentage, questionLog);
    }

    function resetQuiz() {
      userAnswers = [];
      questionLog = [];
      currentSegment = 0;
      document.getElementById("finalScore").classList.add("hidden");
      document.getElementById("quizPanel").classList.add("hidden");
      document.getElementById("loginPanel").classList.remove("hidden");
    }

    function sendToGoogleSheet(name, email, segments, total, totalQuestions, percentage, questionDetails) {
  const data = {
    quiz: quizName,
    name: name,
    email: email,
    topics: segments.join("; "),
    total: total,
    totalQuestions: totalQuestions,
    percentage: percentage,
    questionDetails: questionDetails.map(q => `${q.question} | Selected: ${q.selected} | Correct: ${q.correct}`).join(" // ")
  };

  fetch("https://script.google.com/macros/s/AKfycby-QxAhKWJkvHwGLpu5X6XRGDhxLXgLCsSesuEw763SKKszH8wPCAACybnMnmXnap8IIQ/exec", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  }).then(() => { // Add a .then() block
    alert("Quiz results have been submitted!"); // Display an alert
  }).catch(error => { // Optional: Add a .catch() for error handling, though less useful with no-cors
    console.error("Error submitting results:", error);
    alert("There was an issue submitting your quiz results. Please try again.");
  });
}
  </script>
</body>
</html>